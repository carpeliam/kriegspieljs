<!DOCTYPE html> 
<html> 
<head> 
  <meta charset="utf-8"> 
  <title>kriegspieljs</title> 
  <meta name="viewport" content="width=1024, user-scalable=no"> 
  
  <!-- Replace path with correct path to deck.core.css. --> 
  <link rel="stylesheet" href="deck.core.css" type="text/css"> 
  <link rel="stylesheet" href="themes/style/web-2.0.css">
  <link rel="stylesheet" href="extensions/codemirror/deck.codemirror.css">
  <link rel="stylesheet" href="extensions/codemirror/themes/default.css">
  <link rel="stylesheet" href="themes/transition/horizontal-slide.css">
  <link rel="stylesheet" href="custom.css">
  
  <!-- Any other extension CSS files go here. --> 
  
  <!-- Replace path with correct path to Modernizr file. --> 
  <script src="modernizr.custom.js"></script> 
</head> 
<body class="deck-container"> 
 
<!-- Create any number of elements with class slide within the container --> 

<div class="slide" id="intro">
  <div><h1>kriegspieljs</h1>
  <cite>slides: <a href="http://carpeliam.github.com/kriegspieljs/lightning/">http://carpeliam.github.com/kriegspieljs/lightning</a></cite></div>
</div>
  
  <div class="slide">
    <h2>who are you?</h2>
    <ul>
      <li><a href="http://www.carpeliam.com/">liam morley</a></li>
      <li>software developer, the <span class="mitre">mitre</span> corporation</li>
      <li>web/open source enthusiast</li>
    </ul>
  </div>

<div class="slide">
  <h2>what's kriegspiel?</h2>
  <iframe width="95%" height="380" src="http://en.wikipedia.org/wiki/Kriegspiel_(chess)" frameborder="0"></iframe>
  <div style="text-align: right; margin-top: 0px; font-size: 80%">
    <cite><a href="http://en.wikipedia.org/wiki/Kriegspiel_(chess)">http://en.wikipedia.org/wiki/Kriegspiel_(chess)</a></cite>
  </div>
  <div width="95%">
    <ul>
      <li>move-based (like chess)</li>
      <li>can't see opponent's pieces</li>
      <li>three boards: white, black, and umpire/spectators</li>
    </ul>
  </div>
</div>

<div class="slide">
  <h2>that's... pretty nerdy. why?</h2>
  <ul>
    <li class="slide">play with friend in Europe (without having to pay)</li>
    <li class="slide">improve my html5 skillz
      <ul>
        <li><a href="http://nodejs.org/">node.js</a></li>
        <li>Web Sockets (w/<a href="http://socket.io/">socket.io</a>)</li>
        <li>CSS3</li>
      </ul>
    </li>
  </ul>
</div>

<div class="slide">
  <h2>59 second demo</h2>
  <video width="95%" id="demo">
    <source src="video.high.m4v"></source>
  </video>
  <div id="demo-notes"></div>
  <div id="small-notes"></div>
</div>

<div class="slide code-example">
  <h2>what's the code look like?</h2>
  <div class="code" mode="javascript" style="display: none;">class Board
  # initialize constants, like WHITE, BLACK, QUEEN, ROOK, etc
  constructor: (@options = {}) ->
    @squares = []
    @squares[i] = [] for i in [0..8]
    @init()

  init: ->
    @squares[0][0] = @squares[7][0] = WHITE*ROOK
    # ...

  canMove: (xOrig, yOrig, xNew, yNew) ->
    return false if !@squares[xNew]? or !@squares[xNew][yNew]?
    color = @color(xOrig, yOrig)
    return false if color != @turn or color is @color(xNew, yNew)
    return false if @moveResultsInCheck(xOrig, yOrig, xNew, yNew)
    switch @pieceType(xOrig, yOrig)
      when PAWN
        # ...
      when KNIGHT
        # ...
      when BISHOP
        return false if Math.abs(xNew - xOrig) != Math.abs(yNew - yOrig)
        return false if @passesOverPieces(xOrig, yOrig, xNew, yNew)
      # when ...
    true

  # ...
module.exports = Board</div>
</div>

<div class="slide code-example">
  <h2>code, part deux: tests (jasmine)</h2>
  <div class="code" mode="javascript" style="display: none;">describe "Board", ->
  board = undefined
  onCheck = jasmine.createSpy('onCheck')
  beforeEach ->
    Board = require("#{__dirname}/../../lib/Board")
    board = new Board(onCheck: onCheck)

  describe "a piece", ->
    it "can't move off the board", ->
      expect(board.canMove(0, 0, 0, -1)).toBeFalsy()

    it "can't capture a piece of the same color", ->
      expect(board.canMove(4, 0, 4, 1)).toBeFalsy()
      board.forceMove 4, 1, 4, 3
      expect(board.canMove(4, 0, 4, 1)).toBeTruthy()

  describe "a knight", ->
    it "moves in an L shape", ->
      board.forceMove 1, 0, 4, 4
      expect(board.canMove(4, 4, 5, 2)).toBeTruthy()

  describe "a king", ->
    it "fires event when placed in check", ->
      board.forceMove 3, 0, 5, 3
      expect(board.move 5, 3, 5, 6).toBeTruthy()
      expect(onCheck).toHaveBeenCalled()

  # ...</div>
</div>

<div class="slide code-example">
  <h2>code, part tres: socket.io</h2>
  <div class="code" mode="javascript" style="display: none;">@channel.on 'connection', (socket) =>
  socket.on "nickname.set", (name) =>
    @clients[getID(socket)] = id: socket.id, nickname: name
    @channel.emit 'room.list', (client.nickname for id, client of @clients)
    socket.broadcast.emit 'announcement', "#{name} connected"
    socket.emit 'sit', 'white', @clients[@white] if @white?
    socket.emit 'sit', 'black', @clients[@black] if @black?

  socket.on 'sit', (color) =>
    # is this seat empty? if so...
    @channel.emit 'sit', color, @clients[getID(socket)] if canSit

  socket.on 'board.move', (from, to, callback) =>
    if @currentPlayer() == getID(socket) and @board.move from.x, from.y, to.x, to.y
      callback(true) if callback?
      @channel.emit 'board.move', from, to
  
  # ...</div>
</div>

<div class="slide code-example">
  <h2>code, part catorce: client/jQuery</h2>
  <div class="code" mode="javascript" style="display: none;">var Board = require('./board');

$.fn.coordinates = function() {
  var self = $(this[0]);
  if ($('#board td').index(self) == -1) {
    return undefined;
  }
  var x = self.siblings().andSelf().index(self);
  var y = 7 - $('#board tr').index(self.parent());
  return {'x':x, 'y':y};
};

$(document).ready(function() {
  $('#board td').droppable({
    drop: function(event, ui) {
      var tile = $(this);
      var from = ui.draggable.parent().coordinates();
      var to = tile.coordinates();
      client.room.emit('board.move', from, to, function(success) {
        if (success) {
          client.board.move(from.x, from.y, to.x, to.y);
          tile.children().remove().end().append(ui.draggable);
        }
      });
    }
  });
});</div>
</div>

<div class="slide">
  <h2>so what's so good about this?</h2>
  <ul>
    <li>has been a pretty good learning experience</li>
    <li>socket.io is pretty rockin'</li>
    <li>also, browserify? lets you use your server-side code on the client? pretty rockin'.</li>
    <li>node.js was a blast, AAA+++, would use again</li>
    <li>CoffeeScript felt fresh and clean</li>
  </ul>
</div>

<div class="slide">
  <h2>sounds positive. any negatives?</h2>
  <ul>
    <li>not quite sure how to build unit tests around socket.io.</li>
    <li>found myself wanting to write functions inside of functions as a replacement for private methods, this seems smelly.</li>
    <li>still not finished:
      <ul>
        <li>security is weak</li>
        <li>some rules haven't been implemented yet</li>
        <li>would like to add multiple rooms, lobby</li>
      </ul>
    </li>
  </ul>
</div>

<div class="slide">
  <h2>take-aways</h2>
  <ul>
    <li>all of this technology is pretty cool</li>
    <li>if this is something you're interested in, talk to me</li>
    <li>if you see any weak spots in this code, talk to me</li>
    <li>access the code at <a href="https://github.com/carpeliam/kriegspieljs/">https://github.com/carpeliam/kriegspieljs</a></li>
    <li>access the slides at <a href="http://carpeliam.github.com/kriegspieljs/lightning/">http://carpeliam.github.com/kriegspieljs/lightning</a></li>
    <li>play a little kriegspiel at <a href="http://kriegspiel.carpeliam.com:8124/">http://kriegspiel.carpeliam.com:8124</a></li>
  </ul>
</div>

<div class="slide">
  <h2>thank you!</h2>
  <p>Pop Quiz: name the two pieces of open source code contributed in part by members of the Bocoup team in this presentation.</p>
</div>

<!-- Other extension HTML snippets go here, at the bottom of the deck container. --> 
 
<!-- Update these paths to point to the correct files. --> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js"></script>
<script src="deck.core.js"></script>
<script src="popcorn-complete.min.js"></script>
<script src="extensions/codemirror/deck.codemirror.js"></script>
 
<!-- Add any other extension JS files here --> 
 
 
<!-- Initialize the deck. You can put this in an external file if desired. --> 
<script> 
  $(function() {
    $.deck('.slide');
    var pop = Popcorn("#demo");
    
    pop.mute().footnote({
      start: 7,
      end: 11,
      text: "Jack and Jill sign in",
      target: "demo-notes"
    }).footnote({
      start: 11,
      end: 14,
      text: "Spectators can see both sides",
      target: "demo-notes"
    }).footnote({
      start: 14,
      end: 18,
      text: "Once you choose a color, you can only see your side.",
      target: "demo-notes"
    }).footnote({
      start: 18,
      end: 24,
      text: "How are we going to play an entire game of chess? There's only 40 seconds left in this demo!",
      target: "demo-notes"
    }).footnote({
      start: 24,
      end: 30,
      text: "A piece moved to an illegal square just floats back to its starting square (<a href=\"http://jqueryui.com/\">jQuery UI</a> drag+drop)",
      target: "demo-notes"
    }).footnote({
      start: 31,
      end: 39,
      text: "Whenever a move is made, the current player's box flashes (<a href=\"http://www.w3.org/TR/css3-animations/\">CSS3 keyframe animation</a>)",
      target: "demo-notes"
    }).footnote({
      start: 40,
      end: 46,
      text: "I have no way of knowing where my opponent's pieces are!",
      target: "demo-notes"
    }).footnote({
      start: 43,
      end: 46,
      text: "*",
      target: "demo-notes"
    }).footnote({
      start: 43,
      end: 46,
      text: "*There are actually a few ways to cheat. Shhh.",
      target: "small-notes"
    }).footnote({
      start: 46,
      end: 53,
      text: "Moves are validated on the client, then reported to the server and broadcasted to other clients via <a href=\"http://socket.io/\">socket.io</a>.",
      target: "demo-notes"
    }).footnote({
      start: 54,
      text: "Fool's mate. The client has callbacks for check and mate, and announces the winner/loser.",
      target: "demo-notes"
    });
    
    $(document).bind('deck.change', function(event, from, to) {
      if (to === 7) {
        pop.play();
      } else if (from === 7) {
        pop.pause();
      }
    });
  });
</script> 
</body> 
</html>